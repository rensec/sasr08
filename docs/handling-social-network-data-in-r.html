<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Handling social network data in R | SaSR 8: Social Network Analysis</title>
  <meta name="description" content="This page contains tutorials for SaSR 8" />
  <meta name="generator" content="bookdown 0.38 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Handling social network data in R | SaSR 8: Social Network Analysis" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This page contains tutorials for SaSR 8" />
  <meta name="github-repo" content="rensec/sasr08" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Handling social network data in R | SaSR 8: Social Network Analysis" />
  
  <meta name="twitter:description" content="This page contains tutorials for SaSR 8" />
  

<meta name="author" content="Rense Corten" />


<meta name="date" content="2024-03-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">SaSR8 </a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#usage"><i class="fa fa-check"></i><b>1.1</b> Usage</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="handling-social-network-data-in-r.html"><a href="handling-social-network-data-in-r.html"><i class="fa fa-check"></i><b>2</b> Handling social network data in R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="handling-social-network-data-in-r.html"><a href="handling-social-network-data-in-r.html#getting-network-data-into-r-igraph"><i class="fa fa-check"></i><b>2.1</b> Getting network data into R: igraph</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="handling-social-network-data-in-r.html"><a href="handling-social-network-data-in-r.html#creating-network-objects-in-igraph"><i class="fa fa-check"></i><b>2.1.1</b> Creating network objects in igraph</a></li>
<li class="chapter" data-level="2.1.2" data-path="handling-social-network-data-in-r.html"><a href="handling-social-network-data-in-r.html#creating-network-objects-from-adjacency-list-data"><i class="fa fa-check"></i><b>2.1.2</b> Creating network objects from adjacency list data</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="handling-social-network-data-in-r.html"><a href="handling-social-network-data-in-r.html#the-reverse-direction-exporting-from-igraph-objects"><i class="fa fa-check"></i><b>2.2</b> The reverse direction: exporting from igraph objects</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="handling-social-network-data-in-r.html"><a href="handling-social-network-data-in-r.html#from-igraph-to-adjacency-matrix"><i class="fa fa-check"></i><b>2.2.1</b> From igraph to adjacency matrix</a></li>
<li class="chapter" data-level="2.2.2" data-path="handling-social-network-data-in-r.html"><a href="handling-social-network-data-in-r.html#from-igraph-to-edge-list"><i class="fa fa-check"></i><b>2.2.2</b> From igraph to edge list</a></li>
<li class="chapter" data-level="2.2.3" data-path="handling-social-network-data-in-r.html"><a href="handling-social-network-data-in-r.html#back-to-an-adjacency-list-from-igraph"><i class="fa fa-check"></i><b>2.2.3</b> Back to an adjacency list from igraph</a></li>
<li class="chapter" data-level="2.2.4" data-path="handling-social-network-data-in-r.html"><a href="handling-social-network-data-in-r.html#from-edge-list-to-network-package-object"><i class="fa fa-check"></i><b>2.2.4</b> From edge list to network package object</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">SaSR 8: Social Network Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="handling-social-network-data-in-r" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Handling social network data in R<a href="handling-social-network-data-in-r.html#handling-social-network-data-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This R notebook demonstrates some data handling procedures for relational (social network) data, especially data as generated by “name generator” questionnaires.</p>
<p>We start by loading some useful packages:</p>
<ul>
<li><code>igrapg</code> and <code>network</code> are packages specifically for handling network data;</li>
<li><code>reshape2</code> and <code>tidyverse</code> are more general-purpose packages that included useful procedures.</li>
</ul>
<p><strong>NOTE:</strong> if you get any “there is no package called…” error messages, make sure you install these packages first using the <code>install.packages()</code> function (not included here).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="handling-social-network-data-in-r.html#cb1-1" tabindex="-1"></a><span class="fu">library</span>(network)</span>
<span id="cb1-2"><a href="handling-social-network-data-in-r.html#cb1-2" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb1-3"><a href="handling-social-network-data-in-r.html#cb1-3" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb1-4"><a href="handling-social-network-data-in-r.html#cb1-4" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<div id="getting-network-data-into-r-igraph" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Getting network data into R: igraph<a href="handling-social-network-data-in-r.html#getting-network-data-into-r-igraph" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We start by reading some network data from disk (or from the internet, in this case). A simple and very common way to store data is as “comma-separated values” (CSV). Let’s load some “toy data”:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="handling-social-network-data-in-r.html#cb2-1" tabindex="-1"></a>url1 <span class="ot">&lt;-</span> <span class="st">&quot;https://github.com/rensec/sasr08/raw/main/g_adj_matrix_simple.csv&quot;</span></span>
<span id="cb2-2"><a href="handling-social-network-data-in-r.html#cb2-2" tabindex="-1"></a>g_matrix <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> url1, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-3"><a href="handling-social-network-data-in-r.html#cb2-3" tabindex="-1"></a>g_matrix</span></code></pre></div>
<pre><code>##   V1 V2 V3 V4 V5
## 1  0  1  0  1  0
## 2  0  0  1  0  0
## 3  1  0  0  0  0
## 4  0  0  0  0  0
## 5  0  0  0  0  0</code></pre>
<p>These data are stored as an <em>adjacency matrix</em>. While reading the data, R automatically created column names and loaded the data as a data frame:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="handling-social-network-data-in-r.html#cb4-1" tabindex="-1"></a><span class="fu">class</span>(g_matrix)</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<p>For network analysis, this is often not practical; for example we may want to do matrix calculations. So instead, let’s turn this into a matrix object:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="handling-social-network-data-in-r.html#cb6-1" tabindex="-1"></a>g_matrix <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(g_matrix)</span>
<span id="cb6-2"><a href="handling-social-network-data-in-r.html#cb6-2" tabindex="-1"></a>g_matrix</span></code></pre></div>
<pre><code>##      V1 V2 V3 V4 V5
## [1,]  0  1  0  1  0
## [2,]  0  0  1  0  0
## [3,]  1  0  0  0  0
## [4,]  0  0  0  0  0
## [5,]  0  0  0  0  0</code></pre>
<p>For clarity, we also add row- and column names, simply numbering them:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="handling-social-network-data-in-r.html#cb8-1" tabindex="-1"></a><span class="fu">rownames</span>(g_matrix) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(g_matrix)</span>
<span id="cb8-2"><a href="handling-social-network-data-in-r.html#cb8-2" tabindex="-1"></a><span class="fu">colnames</span>(g_matrix) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(g_matrix)</span>
<span id="cb8-3"><a href="handling-social-network-data-in-r.html#cb8-3" tabindex="-1"></a>g_matrix</span></code></pre></div>
<pre><code>##   1 2 3 4 5
## 1 0 1 0 1 0
## 2 0 0 1 0 0
## 3 1 0 0 0 0
## 4 0 0 0 0 0
## 5 0 0 0 0 0</code></pre>
<p><strong>QUESTION:</strong> How many nodes are included in this matrix, and how many edges are there between these nodes?</p>
<p>Typically, information about nodes and edges are stored in separate files. In our next step, we’re reading an attribute of the nodes:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="handling-social-network-data-in-r.html#cb10-1" tabindex="-1"></a>g_nodes_age <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;g_nodes_age.csv&quot;</span>)</span>
<span id="cb10-2"><a href="handling-social-network-data-in-r.html#cb10-2" tabindex="-1"></a>g_nodes_age</span></code></pre></div>
<pre><code>##   id age
## 1  1  20
## 2  2  21
## 3  3  25
## 4  4  NA
## 5  5  21</code></pre>
<p>We now have information about nodes and edges loaded in R . However, to R, these are just like <em>any</em> data; it doesn’t “know” that these are network data. In order to be able to use specific SNA procedures, we first need to create <em>network objects</em>, which is what we’ll do next.</p>
<p><strong>NOTE:</strong> the data that we’ve loaded now just happened to be stored as an adjacency matrix; it is also possible to store network data on disk in other formats. We’ll get to that later.</p>
<div id="creating-network-objects-in-igraph" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Creating network objects in igraph<a href="handling-social-network-data-in-r.html#creating-network-objects-in-igraph" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Network analysis packages such as <code>igraph</code> handle data efficiently by storing data in their own type of <em>objects</em>, which basically ensure that all procedures make sense for network data. A network object as used by <code>igraph</code> includes the information on both edges and nodes of a network in a single “box” (and potentially other information about the network too).</p>
<p>To create an <code>igraph</code> network object from our matrix object we run:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="handling-social-network-data-in-r.html#cb12-1" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">graph_from_adjacency_matrix</span>(g_matrix)</span>
<span id="cb12-2"><a href="handling-social-network-data-in-r.html#cb12-2" tabindex="-1"></a><span class="fu">class</span>(g)</span></code></pre></div>
<pre><code>## [1] &quot;igraph&quot;</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="handling-social-network-data-in-r.html#cb14-1" tabindex="-1"></a>g</span></code></pre></div>
<pre><code>## IGRAPH e20e94d DN-- 5 4 -- 
## + attr: name (v/c)
## + edges from e20e94d (vertex names):
## [1] 1-&gt;2 1-&gt;4 2-&gt;3 3-&gt;1</code></pre>
<p>The output from running “g” already shows that this is now a network object (specifically: an object of the class “igraph”, as shown by <code>class()</code>): R interprets the object as a network and shows us the edges in the network. This also means that other R functions - to the extent that they have network methods implemented - now automatically recognize <code>g</code> as a network object and will behave accordingly (note that this is a key feature of R as an “object-oriented language”). For example, we can now run the standard <code>plot()</code> function and it will create a network map:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="handling-social-network-data-in-r.html#cb16-1" tabindex="-1"></a><span class="fu">plot</span>(g)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Now we can also add node attributes to the object (in this case we have only one):</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="handling-social-network-data-in-r.html#cb17-1" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">set_vertex_attr</span>(g, </span>
<span id="cb17-2"><a href="handling-social-network-data-in-r.html#cb17-2" tabindex="-1"></a>                     <span class="at">name =</span> <span class="st">&quot;age&quot;</span>,</span>
<span id="cb17-3"><a href="handling-social-network-data-in-r.html#cb17-3" tabindex="-1"></a>                     <span class="at">value =</span> g_nodes_age<span class="sc">$</span>age)</span></code></pre></div>
</div>
<div id="creating-network-objects-from-adjacency-list-data" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Creating network objects from adjacency list data<a href="handling-social-network-data-in-r.html#creating-network-objects-from-adjacency-list-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A common format for network data, especially if collected via survey methods, is the <em>adjacency list</em>. In this format, we have a row for each node, and columns that indicate the first, second, third…etc connection of each node. The file <code>g_adj_list.csv</code> is an example of this format (it is again our toy network as used in the previous excercises).</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="handling-social-network-data-in-r.html#cb18-1" tabindex="-1"></a>g_adj_list <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;g_adj_list.csv&quot;</span>)</span>
<span id="cb18-2"><a href="handling-social-network-data-in-r.html#cb18-2" tabindex="-1"></a>g_adj_list</span></code></pre></div>
<pre><code>##   id age friend1 friend2
## 1  1  20       2       4
## 2  2  21       3      NA
## 3  3  25       1      NA
## 4  4  NA      NA      NA
## 5  5  21      NA      NA</code></pre>
<p>Note that:</p>
<ul>
<li><p>The columns “friend1” and “friend2” could, for example, refer to “name generator” survey questions, where each node number in the column refers to a friend “nominated” by the node (respondent) in the corresponding row. In this case, the nodes can have at most two (outgoing) ties.</p></li>
<li><p>This format allows for easy inclusion of node attributes as well, such as, in this case, the column “age”.</p></li>
</ul>
<p>The most convenient way to create a network object from these data, is to first transform them into an <em>edge list</em>, as this is a format for which <code>igraph</code> has an import function, such that we can turn it into a network object.</p>
<p>To create an edge list, we first make the data <em>long</em>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="handling-social-network-data-in-r.html#cb20-1" tabindex="-1"></a>g_elist_from_alist <span class="ot">&lt;-</span> g_adj_list <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="handling-social-network-data-in-r.html#cb20-2" tabindex="-1"></a>  <span class="fu">select</span>(id, friend1<span class="sc">:</span>friend2) <span class="sc">%&gt;%</span> <span class="co">#keep only the network variables (and id)</span></span>
<span id="cb20-3"><a href="handling-social-network-data-in-r.html#cb20-3" tabindex="-1"></a>  <span class="fu">melt</span>( <span class="at">id.vars =</span> <span class="st">&quot;id&quot;</span>) <span class="co">#from the reshape2 package</span></span>
<span id="cb20-4"><a href="handling-social-network-data-in-r.html#cb20-4" tabindex="-1"></a>g_elist_from_alist</span></code></pre></div>
<pre><code>##    id variable value
## 1   1  friend1     2
## 2   2  friend1     3
## 3   3  friend1     1
## 4   4  friend1    NA
## 5   5  friend1    NA
## 6   1  friend2     4
## 7   2  friend2    NA
## 8   3  friend2    NA
## 9   4  friend2    NA
## 10  5  friend2    NA</code></pre>
<p>We could do the same using the <code>tidyr</code> package (automatically loaded with <code>tidyverse</code>:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="handling-social-network-data-in-r.html#cb22-1" tabindex="-1"></a>g_adj_list <span class="sc">%&gt;%</span> <span class="co"># (we don&#39;t save it into an object as above this time, since we just want to show that the result is the same)</span></span>
<span id="cb22-2"><a href="handling-social-network-data-in-r.html#cb22-2" tabindex="-1"></a>  <span class="fu">select</span>(id, friend1<span class="sc">:</span>friend2) <span class="sc">%&gt;%</span> <span class="co">#keep only the network variables (and id)</span></span>
<span id="cb22-3"><a href="handling-social-network-data-in-r.html#cb22-3" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(friend1, friend2))</span></code></pre></div>
<pre><code>## # A tibble: 10 × 3
##       id name    value
##    &lt;int&gt; &lt;chr&gt;   &lt;int&gt;
##  1     1 friend1     2
##  2     1 friend2     4
##  3     2 friend1     3
##  4     2 friend2    NA
##  5     3 friend1     1
##  6     3 friend2    NA
##  7     4 friend1    NA
##  8     4 friend2    NA
##  9     5 friend1    NA
## 10     5 friend2    NA</code></pre>
<p>To create an edge list we subsequently drop all missing values on “value” and do some housekeeping:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="handling-social-network-data-in-r.html#cb24-1" tabindex="-1"></a>g_elist_from_alist <span class="ot">&lt;-</span> g_elist_from_alist<span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="handling-social-network-data-in-r.html#cb24-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span> <span class="co"># drop the missings</span></span>
<span id="cb24-3"><a href="handling-social-network-data-in-r.html#cb24-3" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">from =</span><span class="st">&quot;id&quot;</span>, <span class="at">to =</span> <span class="st">&quot;value&quot;</span>, <span class="at">sourcevar=</span> <span class="st">&quot;variable&quot;</span>) <span class="sc">%&gt;%</span> <span class="co">#just nice for interpretation</span></span>
<span id="cb24-4"><a href="handling-social-network-data-in-r.html#cb24-4" tabindex="-1"></a>  <span class="fu">relocate</span>(to, <span class="at">.after=</span>from) <span class="co">#move around the columns</span></span>
<span id="cb24-5"><a href="handling-social-network-data-in-r.html#cb24-5" tabindex="-1"></a>g_elist_from_alist</span></code></pre></div>
<pre><code>##   from to sourcevar
## 1    1  2   friend1
## 2    2  3   friend1
## 3    3  1   friend1
## 4    1  4   friend2</code></pre>
<p>We can now interpret each {from,to} combination as a directed edge (tie) from respondent to alter; <code>sourcevar</code> is an <em>edge attribute</em> indicating where in the adjacency list columns the alter was mentioned. Strictly speaking you don’t need the latter for a simple edge list, but it’s useful to keep in case you want to reverse the procedure.</p>
<p><strong>QUESTION:</strong> Besides useful more data manipulation procedures, keeping the information in <code>sourcevar</code> could also be important for more substantive reasons. Can you think of such a reason?</p>
<p>Now we can import this into a network object with an <code>igraph</code> function:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="handling-social-network-data-in-r.html#cb26-1" tabindex="-1"></a>g_from_elist <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(g_elist_from_alist) <span class="co">#This is a proper igraph graph object</span></span>
<span id="cb26-2"><a href="handling-social-network-data-in-r.html#cb26-2" tabindex="-1"></a><span class="fu">plot</span>(g_from_elist)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>Note however that we lost the isolate! To include the isolate, we need to feed the function also the list of <em>all</em> the nodes:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="handling-social-network-data-in-r.html#cb27-1" tabindex="-1"></a>nodelist <span class="ot">&lt;-</span> <span class="fu">select</span>(g_adj_list,id,age)</span>
<span id="cb27-2"><a href="handling-social-network-data-in-r.html#cb27-2" tabindex="-1"></a>g_from_elist <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(g_elist_from_alist, <span class="at">vertices =</span> nodelist) <span class="co">#This is a proper igraph graph object</span></span>
<span id="cb27-3"><a href="handling-social-network-data-in-r.html#cb27-3" tabindex="-1"></a><span class="fu">plot</span>(g_from_elist)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>That’s better! Note that besides the node IDs, we also include the age variable in the network object as a node attribute, such that we could use it in analyses based on the network object.</p>
</div>
</div>
<div id="the-reverse-direction-exporting-from-igraph-objects" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> The reverse direction: exporting from igraph objects<a href="handling-social-network-data-in-r.html#the-reverse-direction-exporting-from-igraph-objects" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Handling your network data as igraph objects is useful for social network analysis, but sometimes we also want to transform our data back from network objects to “regular” matrix objects or data frames. We briefly cover some of these cases here.</p>
<div id="from-igraph-to-adjacency-matrix" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> From igraph to adjacency matrix<a href="handling-social-network-data-in-r.html#from-igraph-to-adjacency-matrix" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="handling-social-network-data-in-r.html#cb28-1" tabindex="-1"></a>g_adj_matrix <span class="ot">&lt;-</span> <span class="fu">as_adjacency_matrix</span>(g, <span class="at">sparse =</span> <span class="cn">FALSE</span>)</span>
<span id="cb28-2"><a href="handling-social-network-data-in-r.html#cb28-2" tabindex="-1"></a>g_adj_matrix</span></code></pre></div>
<pre><code>##   1 2 3 4 5
## 1 0 1 0 1 0
## 2 0 0 1 0 0
## 3 1 0 0 0 0
## 4 0 0 0 0 0
## 5 0 0 0 0 0</code></pre>
<p>We here specify <code>sparse = FALSE</code> because by default, <code>as_adjacency_matrix()</code> will return a “sparse matrix” (just run <code>as_adjacenct_matrix(g)</code> on your R console and see what comes out), which is a somewhat more efficient way of handling matrices with many zeroes. To demonstrate that we can recreate our original adjacency matrix however, we don’t want that here. To check whether the resulting matrix is indeed identical to what we originally read from disk we can do:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="handling-social-network-data-in-r.html#cb30-1" tabindex="-1"></a><span class="fu">all</span>(g_adj_matrix <span class="sc">==</span> g_matrix)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="from-igraph-to-edge-list" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> From igraph to edge list<a href="handling-social-network-data-in-r.html#from-igraph-to-edge-list" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="handling-social-network-data-in-r.html#cb32-1" tabindex="-1"></a>g_edgelist <span class="ot">&lt;-</span> igraph<span class="sc">::</span><span class="fu">as_data_frame</span>(g_from_elist, <span class="at">what =</span> <span class="st">&quot;edges&quot;</span>) </span>
<span id="cb32-2"><a href="handling-social-network-data-in-r.html#cb32-2" tabindex="-1"></a>g_edgelist </span></code></pre></div>
<pre><code>##   from to sourcevar
## 1    1  2   friend1
## 2    2  3   friend1
## 3    3  1   friend1
## 4    1  4   friend2</code></pre>
<p>Note the use of the “namespace” “igraph::” here, to indicate that we need the igraph function here, not the function with the same name from the dplyr/tidyverse package</p>
<p>Note that now, once more, we have lost our isolated node 5! To get all nodes, we could simply run:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="handling-social-network-data-in-r.html#cb34-1" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">as_data_frame</span>(g_from_elist, <span class="at">what =</span> <span class="st">&quot;vertices&quot;</span>) </span></code></pre></div>
<pre><code>##   name age
## 1    1  20
## 2    2  21
## 3    3  25
## 4    4  NA
## 5    5  21</code></pre>
</div>
<div id="back-to-an-adjacency-list-from-igraph" class="section level3 hasAnchor" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Back to an adjacency list from igraph<a href="handling-social-network-data-in-r.html#back-to-an-adjacency-list-from-igraph" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="handling-social-network-data-in-r.html#cb36-1" tabindex="-1"></a>edgelist_2 <span class="ot">&lt;-</span> igraph<span class="sc">::</span><span class="fu">as_data_frame</span>(g_from_elist, <span class="at">what =</span> <span class="st">&quot;edges&quot;</span>)</span>
<span id="cb36-2"><a href="handling-social-network-data-in-r.html#cb36-2" tabindex="-1"></a>nodelist_2 <span class="ot">&lt;-</span> igraph<span class="sc">::</span><span class="fu">as_data_frame</span>(g_from_elist, <span class="at">what =</span> <span class="st">&quot;vertices&quot;</span>)</span>
<span id="cb36-3"><a href="handling-social-network-data-in-r.html#cb36-3" tabindex="-1"></a><span class="co"># Note the use of the &quot;namespace&quot; &quot;igraph::&quot; here, to indicate that we need the igraph function here, not the function with the same name from the dplyr/tidyverse package</span></span>
<span id="cb36-4"><a href="handling-social-network-data-in-r.html#cb36-4" tabindex="-1"></a></span>
<span id="cb36-5"><a href="handling-social-network-data-in-r.html#cb36-5" tabindex="-1"></a>d <span class="ot">&lt;-</span> edgelist_2 <span class="sc">%&gt;%</span></span>
<span id="cb36-6"><a href="handling-social-network-data-in-r.html#cb36-6" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">id =</span> <span class="st">&quot;from&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-7"><a href="handling-social-network-data-in-r.html#cb36-7" tabindex="-1"></a>  <span class="fu">pivot_wider</span>( <span class="at">id_cols =</span> id, <span class="at">names_from =</span> sourcevar, <span class="at">values_from =</span> to ) <span class="sc">%&gt;%</span> </span>
<span id="cb36-8"><a href="handling-social-network-data-in-r.html#cb36-8" tabindex="-1"></a>  <span class="fu">merge</span>(nodelist_2, <span class="at">by.x =</span> <span class="st">&quot;id&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;name&quot;</span>, <span class="at">all.y =</span> <span class="cn">TRUE</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb36-9"><a href="handling-social-network-data-in-r.html#cb36-9" tabindex="-1"></a>  <span class="fu">relocate</span>(age, <span class="at">.after =</span> id) <span class="sc">%&gt;%</span> </span>
<span id="cb36-10"><a href="handling-social-network-data-in-r.html#cb36-10" tabindex="-1"></a>  <span class="fu">type_convert</span>() <span class="co">#as_data_frame returns characters; this transforms it back to numeric</span></span></code></pre></div>
<pre><code>## 
## ── Column specification ─────────────────────────────────────────────────────────────────────────────
## cols(
##   id = col_double(),
##   friend1 = col_double(),
##   friend2 = col_double()
## )</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="handling-social-network-data-in-r.html#cb38-1" tabindex="-1"></a>d</span></code></pre></div>
<pre><code>##   id age friend1 friend2
## 1  1  20       2       4
## 2  2  21       3      NA
## 3  3  25       1      NA
## 4  4  NA      NA      NA
## 5  5  21      NA      NA</code></pre>
<p>…and we’re back!</p>
</div>
<div id="from-edge-list-to-network-package-object" class="section level3 hasAnchor" number="2.2.4">
<h3><span class="header-section-number">2.2.4</span> From edge list to network package object<a href="handling-social-network-data-in-r.html#from-edge-list-to-network-package-object" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can also import it into a network object using the network package (as used by the <code>sna</code> and <code>ergm</code> packages).</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="handling-social-network-data-in-r.html#cb40-1" tabindex="-1"></a>graph_3 <span class="ot">&lt;-</span> <span class="fu">as.network</span>(g_elist_from_alist, <span class="at">matrix.type =</span> <span class="st">&quot;edgelist&quot;</span>, <span class="at">vertices =</span> nodelist)</span>
<span id="cb40-2"><a href="handling-social-network-data-in-r.html#cb40-2" tabindex="-1"></a>graph_3</span></code></pre></div>
<pre><code>##  Network attributes:
##   vertices = 5 
##   directed = TRUE 
##   hyper = FALSE 
##   loops = FALSE 
##   multiple = FALSE 
##   bipartite = FALSE 
##   total edges= 4 
##     missing edges= 0 
##     non-missing edges= 4 
## 
##  Vertex attribute names: 
##     age vertex.names 
## 
##  Edge attribute names: 
##     sourcevar</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="handling-social-network-data-in-r.html#cb42-1" tabindex="-1"></a><span class="fu">plot</span>(graph_3)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/02_sasr08_tutorial_1_1_data_handling.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
